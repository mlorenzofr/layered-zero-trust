# Default values for qtodo
global:
  localClusterDomain: apps.example.com
  secretStore:
    name: "vault-backend"
    kind: "ClusterSecretStore"

# QTodo application configuration
app:
  name: qtodo
  images:
    main:
      name: quay.io/validatedpatterns/qtodo
      version: latest
      # Modified to Always to force a pull so we can test changes to the container image without requiring manual deletion of images or restarts of argo
      pullPolicy: Always
      registry:
        auth: false
        secretName: qtodo-registry-auth
        user: quay-user
        # domain: quay-registry-quay-quay-enterprise.apps.example.com
        # Registry credentials - stored in quay path
        vaultPath: secret/data/hub/infra/quay/quay-users
        passwordVaultKey: quay-user-password
    spiffeHelper:
      name: registry.redhat.io/zero-trust-workload-identity-manager/spiffe-helper-rhel9
      version: v0.10.0
      pullPolicy: IfNotPresent
    spiffeVaultClient:
      name: registry.redhat.io/ubi9/python-311
      version: latest
      pullPolicy: IfNotPresent
    postgresql:
      name: registry.redhat.io/rhel8/postgresql-16
      version: latest
      pullPolicy: IfNotPresent

  oidc:
    enabled: false  # Will be enabled when SPIFFE is enabled
    authServerUrl: ""
    clientId: qtodo-app
    applicationType: "web-app"
    authenticatedPaths: "/*"
    authenticatedPolicy: "authenticated"

  # Keycloak realm configuration
  keycloak:
    realm: "ztvp"

  spire:
    enabled: true   # Enable SPIFFE + OIDC integration by default
    sidecars: true
    audiences:
      - qtodo

  # Vault configuration for SPIFFE integration
  # Uses SPIFFE JWT to authenticate and fetch DB password
  vault:
    url: ""
    role: "qtodo"
    # QTodo secrets path (app-level isolation)
    secretPath: "secret/data/apps/qtodo/qtodo-db"

  # OIDC External Secret configuration
  oidcSecret:
    enabled: true
    name: "oidc-client-secret"
    # QTodo OIDC secret path (app-level isolation)
    vaultPath: "secret/data/apps/qtodo/qtodo-oidc-client"

  # Truststore configuration for Java CA certificates (PKCS12 format)
  truststore:
    enabled: true
    secretName: "qtodo-truststore-secret"
    # QTodo truststore password path (app-level isolation)
    vaultPath: "secret/data/apps/qtodo/qtodo-truststore"

# PostgreSQL database configuration
postgresql:
  name: qtodo-db

  # Database configuration
  auth:
    secretName: qtodo-db-secret
    database: tasks
    username: qtodo_user
    # QTodo DB password path (app-level isolation)
    passwordVaultKey: secret/data/apps/qtodo/qtodo-db
